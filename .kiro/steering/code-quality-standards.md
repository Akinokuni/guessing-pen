# 代码质量与架构设计标准

## 硬性指标

### 文件行数限制
- **动态语言**（Python、JavaScript、TypeScript 等）：每个代码文件不超过 **200 行**
- **静态语言**（Java、Go、Rust 等）：每个代码文件不超过 **250 行**

### 文件夹结构限制
- 每层文件夹中的文件数量不超过 **8 个**
- 如有超过，需要规划为多层子文件夹进行组织

## 架构设计原则

### 避免代码"坏味道"

#### 1. 僵化 (Rigidity)
- **定义**：系统难以变更，任何微小的改动都会引发一连串的连锁修改
- **识别标志**：修改一个功能需要同时修改多个不相关的文件
- **预防措施**：使用依赖注入、接口抽象、模块化设计

#### 2. 冗余 (Redundancy)
- **定义**：同样的代码逻辑在多处重复出现，导致维护困难且容易产生不一致
- **识别标志**：相同或相似的代码块在多个地方出现
- **预防措施**：提取公共函数、使用工具类、创建可复用组件

#### 3. 循环依赖 (Circular Dependency)
- **定义**：两个或多个模块互相纠缠，形成无法解耦的"死结"
- **识别标志**：模块 A 依赖模块 B，同时模块 B 也依赖模块 A
- **预防措施**：使用依赖倒置原则、引入中介者模式、重新设计模块边界

#### 4. 脆弱性 (Fragility)
- **定义**：对代码一处的修改，导致了系统中其他看似无关部分功能的意外损坏
- **识别标志**：修改代码后出现意外的测试失败或功能异常
- **预防措施**：编写全面的单元测试、使用类型系统、遵循单一职责原则

#### 5. 晦涩性 (Obscurity)
- **定义**：代码意图不明，结构混乱，导致阅读者难以理解其功能和设计
- **识别标志**：代码缺乏注释、命名不清晰、逻辑复杂难懂
- **预防措施**：使用清晰的命名、添加适当注释、简化复杂逻辑

#### 6. 数据泥团 (Data Clump)
- **定义**：多个数据项总是一起出现在不同方法的参数中
- **识别标志**：相同的参数组合在多个函数中重复出现
- **预防措施**：创建数据对象、使用参数对象模式、定义值对象

#### 7. 不必要的复杂性 (Needless Complexity)
- **定义**：用"杀牛刀"去解决"杀鸡"的问题，过度设计使系统变得臃肿且难以理解
- **识别标志**：简单功能使用了过于复杂的设计模式或架构
- **预防措施**：遵循 YAGNI 原则、优先选择简单解决方案、渐进式重构

## 设计系统强制遵循原则

### UI 设计规范
- **强制要求**：任何涉及 UI 设计的新增、修改、迭代，必须优先并严格使用 `design-system/` 的组件与 tokens
- **禁止行为**：绕过设计系统手写样式或自建变体
- **扩展流程**：若设计系统暂不覆盖所需功能，先扩展设计系统，再落地业务需求

### 设计系统优先级
1. 首先检查现有设计系统组件是否满足需求
2. 如不满足，扩展现有组件或创建新组件
3. 更新设计系统文档和测试
4. 在业务代码中使用设计系统组件

## 执行要求

### 代码审核标准
- **编写代码时**：严格遵守上述硬性指标和架构设计原则
- **代码审核时**：识别并指出违反原则的代码
- **发现问题时**：立即询问用户是否需要优化，并给出合理的优化建议

### 质量保证流程
1. 代码编写前进行架构设计评估
2. 编写过程中持续检查文件行数和文件夹结构
3. 代码完成后进行"坏味道"检测
4. 发现问题立即重构优化
5. 确保设计系统的正确使用

## 重要提醒

⚠️ **非常重要**：无论是编写代码还是审核代码，都要严格遵守上述标准。

⚠️ **非常重要**：一旦识别出可能侵蚀代码质量的"坏味道"，应当立即询问用户是否需要优化，并给出合理的优化建议。

⚠️ **设计系统强制遵循**：任何 UI 相关的开发都必须优先使用设计系统，不得绕过。