# 项目文件系统整理规范

## 当前项目结构分析

### ✅ 已经规范的部分
1. **设计系统架构**: `src/design-system/` 目录结构清晰
2. **TypeScript 配置**: 路径映射和严格模式已配置
3. **组件分离**: 业务组件和设计系统组件分离
4. **状态管理**: 使用 Zustand 进行集中状态管理

### ⚠️ 需要优化的部分
1. **文件数量控制**: 部分目录可能超过8个文件限制
2. **代码行数检查**: 需要检查是否有文件超过200行
3. **依赖关系**: 需要检查是否存在循环依赖

## 文件系统整理计划

### 第一阶段：结构优化
```
src/
├── components/          # 业务组件 (≤8个文件)
│   ├── game/           # 游戏相关组件
│   ├── ui/             # 通用UI组件
│   └── index.ts        # 统一导出
├── design-system/       # 设计系统 (强制优先)
│   ├── components/     # 基础组件
│   ├── tokens/         # 设计令牌
│   ├── themes/         # 主题配置
│   └── index.ts        # 统一导出
├── views/              # 页面视图 (≤8个文件)
├── store/              # 状态管理
│   ├── slices/         # 状态切片
│   └── index.ts        # 统一导出
├── services/           # API服务
│   ├── api/            # API调用
│   ├── types/          # 服务类型
│   └── index.ts        # 统一导出
├── utils/              # 工具函数
│   ├── game/           # 游戏逻辑工具
│   ├── ui/             # UI工具
│   └── index.ts        # 统一导出
└── types/              # 全局类型定义
```

### 第二阶段：代码质量检查

#### 文件行数检查清单
- [ ] `src/components/*.tsx` - 检查是否超过200行
- [ ] `src/views/*.tsx` - 检查是否超过200行
- [ ] `src/utils/*.ts` - 检查是否超过150行
- [ ] `src/store/*.ts` - 检查是否超过200行

#### 依赖关系检查
- [ ] 检查组件间是否存在循环依赖
- [ ] 检查模块导入是否合理
- [ ] 检查是否有未使用的导入

### 第三阶段：设计系统强化

#### 设计系统组件清单
```
design-system/
├── components/
│   ├── Button/         # 按钮组件
│   ├── Card/           # 卡片组件
│   ├── Modal/          # 模态框组件
│   ├── Input/          # 输入组件
│   ├── Layout/         # 布局组件
│   └── Navigation/     # 导航组件
├── tokens/
│   ├── colors.ts       # 颜色令牌
│   ├── typography.ts   # 字体令牌
│   ├── spacing.ts      # 间距令牌
│   └── breakpoints.ts  # 断点令牌
└── themes/
    ├── light.ts        # 浅色主题
    └── dark.ts         # 深色主题
```

## 代码坏味道检查清单

### 🔍 必须检查的问题

#### 1. 僵化 (Rigidity)
- [ ] 修改游戏逻辑是否需要同时修改多个组件？
- [ ] 添加新卡片类型是否需要修改多处代码？
- [ ] 状态变更是否影响了不相关的组件？

#### 2. 冗余 (Redundancy)
- [ ] 卡片渲染逻辑是否在多个组件中重复？
- [ ] API调用模式是否重复？
- [ ] 样式定义是否有重复？

#### 3. 循环依赖 (Circular Dependency)
- [ ] 组件间是否存在相互导入？
- [ ] store 和 service 是否相互依赖？
- [ ] utils 函数是否形成循环调用？

#### 4. 脆弱性 (Fragility)
- [ ] 修改卡片数据结构是否会破坏其他功能？
- [ ] 游戏状态变更是否会导致意外的UI更新？
- [ ] API接口变更是否会影响多个组件？

#### 5. 晦涩性 (Obscurity)
- [ ] 游戏逻辑是否容易理解？
- [ ] 组件职责是否明确？
- [ ] 函数命名是否表达了真实意图？

#### 6. 数据泥团 (Data Clump)
- [ ] 卡片相关参数是否总是一起传递？
- [ ] 游戏配置参数是否应该封装为对象？
- [ ] API请求参数是否可以优化？

#### 7. 过度复杂 (Needless Complexity)
- [ ] 简单的状态管理是否使用了过于复杂的模式？
- [ ] UI组件是否过度抽象？
- [ ] 工具函数是否过度设计？

## 整理执行步骤

### Step 1: 文件数量检查
```bash
# 检查每个目录的文件数量
find src -type d -exec sh -c 'echo "$(ls -1 "$1" | wc -l) files in $1"' _ {} \;
```

### Step 2: 文件行数检查
```bash
# 检查TypeScript文件行数
find src -name "*.ts" -o -name "*.tsx" | xargs wc -l | sort -n
```

### Step 3: 依赖关系分析
- 使用工具检查循环依赖
- 分析导入导出关系
- 优化模块结构

### Step 4: 设计系统审查
- 检查是否所有UI组件都使用了设计系统
- 识别绕过设计系统的代码
- 补充缺失的设计系统组件

### Step 5: 代码质量提升
- 重构超长文件
- 消除代码重复
- 简化复杂逻辑
- 改善命名和注释

## 长期维护规范

### 每次提交前检查
- [ ] 新增文件是否符合命名规范
- [ ] 文件行数是否在限制范围内
- [ ] 是否使用了设计系统组件
- [ ] 是否引入了新的代码坏味道

### 每周代码审查
- [ ] 检查目录文件数量
- [ ] 审查新增的依赖关系
- [ ] 评估代码复杂度
- [ ] 更新文档和注释

### 每月架构评估
- [ ] 整体架构是否仍然合理
- [ ] 设计系统是否需要扩展
- [ ] 性能是否有退化
- [ ] 技术债务是否需要处理

## 工具和自动化

### 推荐工具
- **ESLint**: 代码质量检查
- **Prettier**: 代码格式化
- **TypeScript**: 类型检查
- **Madge**: 依赖关系分析
- **Size Limit**: 包大小控制

### 自动化脚本
```json
{
  "scripts": {
    "check:files": "node scripts/check-file-count.js",
    "check:lines": "node scripts/check-line-count.js",
    "check:deps": "madge --circular src/",
    "check:quality": "npm run check:files && npm run check:lines && npm run check:deps"
  }
}
```

---

**执行原则**:
1. **渐进式改进**: 不要一次性大规模重构
2. **保持功能稳定**: 整理过程中确保功能正常
3. **文档同步更新**: 结构变更后及时更新文档
4. **团队协作**: 重大变更需要团队讨论确认